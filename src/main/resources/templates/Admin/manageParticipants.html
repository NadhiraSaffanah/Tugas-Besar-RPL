<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manage Participants</title>
    <link rel="stylesheet" th:href="@{/css/admin/manageParticipantStyle.css}">
    <script th:src="@{/js/admin/manageParticipantsAdmin.js}" defer></script>
</head>
<body>
    <header>
        <nav>
            <ul id="nav-left">
                <li><img th:src="@{/images/Logo.png}" alt="book icon"></li>
                <li><a th:href="@{'/admin/home'}">Home</a></li>
                <li><a th:href="@{'/admin/semesters'}">Course</a></li>
            </ul>
            <ul id="nav-right">
                <li>
                    <span th:text="${user.nama}">Nama User</span> 
                    <span th:text="${user.email}">user@unpar.ac.id</span>
                </li>
                <li>
                    <div>
                        <a href="profile-page.html">
                            <img th:src="${user.fotoProfil != null} 
                                ? @{/uploads/profile/{f}(f=${user.fotoProfil})} 
                                : @{/images/default_profile.png}" 
                                alt="profile picture">
                        </a>
                    </div>
                </li>
                <li><img th:src="@{/images/bell.png}" alt="notification icon"></li>
                <li><a th:href="@{/logout}"><img th:src="@{/images/logout.png}" alt="logout icon"></a></li>
            </ul>
        </nav>
    </header>

    <main>
        <div id="course-overview">
            <ul class="breadcrumb">
                <li>
                    <a th:href="@{'/admin/semesters'}"><h3>Semester</h3></a>
                </li>
                <li>
                    <a th:href="@{'/admin/semesters/' + ${idSemester} + '/courses'}"><h3><span th:text="|${semester.jenis} ${semester.startDate.getYear()}|">Ganjil 2023</span></h3></a>
                </li>
                <li>
                    <a th:href="@{'/admin/semesters/' + ${idSemester} + '/courses/' + ${idMatkul} + '/participants'}"><h3><span th:text="|${matkul.namaMatkul} (${matkul.kelasMatkul})|">Ganjil 2023</span></h3></a>
                </li>
            </ul>
            
            <section id="participant">
                <div id="tab-container">
                    <button class="tab-button active" id="dosen-tab" onclick="switchTab('dosen')">Lecturers</button>
                    <button class="tab-button" id="mahasiswa-tab" onclick="switchTab('mahasiswa')">Student</button>
                </div>

                <div id="participant-card">
                    <div id="search-add-container">
                        <div id="search-container">
                            <img th:src="@{/images/search.svg}" alt="search icon">
                            <input type="text" id="search-input" placeholder="Search" onkeyup="searchUsers()">
                        </div>
                        <button id="add-button" class="add-button" onclick="openForm()">
                            <img th:src="@{/images/add-button.svg}" alt="add icon">
                        </button>
                    </div>

                    <div id="participant-list" class="participant-list">
                        <!-- Dosen participants -->
                        <div id="dosen-participants" class="participant-role-section">
                            <div th:if="${dosenList.isEmpty()}" class="empty-state">
                                <p>No lecturers added yet. Click the + button to add participants.</p>
                            </div>
                            <div th:each="dosen : ${dosenList}" class="participant-item">
                                <div class="participant-avatar">
                                    <span th:text="${dosen.nama != null ? dosen.nama.substring(0, 1).toUpperCase() : 'A'}">A</span>
                                </div>
                                <div class="participant-info">
                                    <div class="participant-name" th:text="${dosen.nama}">Nama</div>
                                    <div class="participant-email" th:text="${dosen.email}">email@unpar.ac.id</div>
                                </div>
                                <button type="button" class="remove-participant-btn" th:data-user-id="${dosen.id}" onclick="removeParticipant(event, this)">×</button>
                            </div>
                        </div>
                        <!-- Mahasiswa participants -->
                        <div id="mahasiswa-participants" class="participant-role-section" style="display: none;">
                            <div th:if="${mahasiswaList.isEmpty()}" class="empty-state">
                                <p>No students added yet. Click the + button to add participants.</p>
                            </div>
                            <div th:each="mahasiswa : ${mahasiswaList}" class="participant-item">
                                <div class="participant-avatar">
                                    <span th:text="${mahasiswa.nama != null ? mahasiswa.nama.substring(0, 1).toUpperCase() : 'A'}">A</span>
                                </div>
                                <div class="participant-info">
                                    <div class="participant-name" th:text="${mahasiswa.nama}">Nama</div>
                                    <div class="participant-email" th:text="${mahasiswa.email}">email@unpar.ac.id</div>
                                </div>
                                <button type="button" class="remove-participant-btn" th:data-user-id="${mahasiswa.id}" onclick="removeParticipant(event, this)">×</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Popup for adding participants -->
                <div class="popup" id="participantForm">
                    <div class="popup-top">
                        <input type="image" src="/images/close-green.svg" onclick="closeForm()"/>
                    </div>
                    <div class="popup-bottom">
                        <div class="popup-header"> 
                            <h1>Add Participant</h1>
                            <span>Add participant with file or search manually. File uploaded must be a CSV and has the following columns: email</span>
                        </div>
                        <div class="popup-body">
                            <input type="file" id="csv-file-input" accept=".csv" class="add-file-btn">
                            <div class="input-section">
                                <div class="input-group">
                                    <label>Search User</label>
                                    <div class="dropdown">
                                        <input type="text" placeholder="Search by name or email.." id="dropdown-search-input" class="manual-input" onkeyup="filterDropdownUsers()" onfocus="loadDropdownUsers()">
                                        <div id="search-available-users" class="dropdown-content">
                                            <div id="dropdown-user-list" class="dropdown-user-list">
                                                <!-- Users will be populated here -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                
                            <div id="participant-list-popup" class="course-list">
                                <!-- Participant items to be added will appear here -->
                            </div>
                    
                        </div>
                        <button type="button" id="submit-participant-btn" class="submit-btn"><b>Add Participant</b></button>
                    </div>
                </div>

                <!-- Pass data to JavaScript -->
                <script th:inline="javascript">
                    window.idMatkul = /*[[${idMatkul}]]*/ null;
                    window.idSemester = /*[[${idSemester}]]*/ null;
                    window.currentRole = 'dosen'; // default role
                </script>
            </section>
        </div>
    </main>
</body>
</html>